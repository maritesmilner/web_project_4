!function(e){var t={};function s(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,s),i.l=!0,i.exports}s.m=e,s.c=t,s.d=function(e,t,r){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(s.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)s.d(r,i,function(t){return e[t]}.bind(null,i));return r},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s(s.s=1)}([function(e,t,s){},function(e,t,s){"use strict";s.r(t);s(0);class r{constructor({items:e,renderer:t},s){this._renderedItems=e,this._renderer=t,this._container=document.querySelector(s)}appendItem(e){this._container.append(e)}prependItem(e){this._container.prepend(e)}clear(){this._container.innerHTML=""}setItems(e){this._renderedItems=e}renderItems(){this.clear(),this._renderedItems.forEach(e=>{this._renderer(e)})}}class i{constructor({likes:e,_id:t,name:s,link:r,owner:i},n,{handleCardClick:o,confirmDelete:a,handleAddLike:l,handleRemoveLike:c},_){this._placeName=s,this._imageURL=r,this._likes=e,this._id=t,this._owner=i,this._templateSelector=n,this._handleCardClick=o,this._handleCardDelete=a,this._handleAddLike=l,this._handleRemoveLike=c,this._userId=_||this._owner._id,this._card=this._setCardElement()}_toggleLike(){this._likeButtonElement.classList.toggle("like__button_active")}_isLiked(){this._likes.some(e=>e._id===this._userId)&&this._toggleLike()}_setLikeCount(e){this._likeCount=e,this._likeCountElement.textContent=e}_getCardTemplate(){return document.querySelector(this._templateSelector).content.querySelector(".place").cloneNode(!0)}_removeCardLike(e){this._handleRemoveLike(this._id).then(t=>{e(t)}).catch(e=>{console.log(e)})}_addCardLike(e){this._handleAddLike(this._id).then(t=>{e(t)}).catch(e=>{console.log(e)})}_handleLikeEvent(){const e=({likes:e})=>{this._likes=e,this._setLikeCount(e.length),this._toggleLike()};this._likeButtonElement.classList.contains("like__button_active")?this._removeCardLike(e):this._addCardLike(e)}_setEventListeners(){this._likeButtonElement.addEventListener("click",()=>{this._handleLikeEvent()}),this._trashButtonElement.addEventListener("click",()=>{this._handleCardDelete(this)}),this._card.querySelector(".place__picture").addEventListener("click",()=>{this._handleCardClick(this._imageURL,this._placeName)})}_setCardElement(){this._card=this._getCardTemplate();const e=this._card.querySelector(".place__picture");return e.src=this._imageURL,e.alt="Picture of "+this._placeName,this._card.querySelector(".place__name").textContent=this._placeName,this._likeCountElement=this._card.querySelector(".like__count"),this._likeButtonElement=this._card.querySelector(".like__button"),this._trashButtonElement=this._card.querySelector(".trash-button"),this._setLikeCount(this._likes.length),this._likeCount>0&&this._isLiked(),this._owner._id!==this._userId&&this._trashButtonElement.classList.add("hide"),this._setEventListeners(),this._card}getCardElement(){return this._card}getId(){return this._id}remove(){this._card.remove(),this._card=null}}const n=document.querySelector(".content"),o=document.getElementById("edit-profile-button"),a=n.querySelector(".profile__avatar-container"),l=n.querySelector(".add-button");class c{constructor(e){this._selector=e,this._popup=document.querySelector(e),this._form=this._popup.querySelector(".form"),this._closeButton=this._popup.querySelector(".form__close-button"),this._closeButton.addEventListener("click",()=>this.close()),this._saveButton=this._popup.querySelector(".form__save-button"),this._saveButton&&(this._saveButtonOrigTxt=this._saveButton.textContent),this._escapeHandler=e=>{"Escape"===e.key&&this.close()}}open(){document.addEventListener("keyup",this._escapeHandler),this._popup.classList.toggle("hide")}close(){document.removeEventListener("keyup",this._escapeHandler),this._popup.classList.toggle("hide")}populatePopup(e){e(this._popup)}setOverlayListener(e){e(this._popup.querySelector(".overlay"))}setFormListener(e){e(this._form)}resetForm(e){e(this._form,this._saveButton,this._saveButtonOrigTxt)}setSaveButtonTxt(e){e(this._saveButton)}getFormFieldValues(e){e(this._form)}enableSaveButton(e){e(this._saveButton)}}class _ extends c{constructor(e,{promise:t,callback:s}){super(e),this._handleFormSubmit=t,this._callback=s,super.setFormListener(e=>{e.addEventListener("submit",e=>{e.preventDefault(),super.setSaveButtonTxt(e=>e.textContent="Saving..."),super.getFormFieldValues(e=>{this._handleFormSubmit(this._getInputValues(e)).then(e=>{this._callback(e)}).catch(e=>{console.log(e)}).finally(()=>{this.close()})})})})}_getInputValues(e){const t=e.querySelectorAll(".form__input"),s={};return t.forEach(e=>{s[e.name]=e.value}),s}close(){super.resetForm((e,t,s)=>{e.reset(),t.textContent=s,t.classList.add("form__save-button_disabled"),t.disabled=!0}),super.close()}setHandleFormSubmit(e){this._handleFormSubmit=e}setCallbacks({promise:e,callback:t}){this._handleFormSubmit=e,this._callback=t}}class u{constructor({submitButtonSelector:e,inputSelector:t,inputErrorClass:s,errorClass:r,inactiveButtonClass:i},n){this._formElement=n,this._submitButtonElement=this._formElement.querySelector(e),this._inputSelector=t,this._inputErrorClass=s,this._errorClass=r,this._inactiveButtonClass=i}_hasInvalidInput(e){return e.some(e=>!e.validity.valid)}_toggleSubmitButtonState(e){this._hasInvalidInput(e)?(this._submitButtonElement.classList.add(this._inactiveButtonClass),this._submitButtonElement.disabled=!0):(this._submitButtonElement.classList.remove(this._inactiveButtonClass),this._submitButtonElement.disabled=!1)}_hideInputError(e){const t=this._formElement.querySelector(`#${e.id}-error`);e.classList.remove(this._inputErrorClass),t.classList.remove(this._errorClass),t.textContent=""}_showInputError(e){const t=this._formElement.querySelector(`#${e.id}-error`);e.classList.add(this._inputErrorClass),t.classList.add(this._errorClass),t.textContent=e.validationMessage}_checkInputValidity(e){e.validity.valid?this._hideInputError(e):this._showInputError(e)}enableValidation(){const e=[...this._formElement.querySelectorAll(this._inputSelector)];e.forEach(t=>{t.addEventListener("input",()=>{this._checkInputValidity(t),this._toggleSubmitButtonState(e)})})}}const h=new class{constructor(e,t){this._baseUrl=e,this._options=t}_getResource(e){return fetch(`${this._baseUrl}/${e}`,this._options)}_getDataPromise(e){return fetch(`${this._baseUrl}/${e}`,this._options).then(e=>e.ok?e.json():Promise.reject("Error: "+e.status))}getInitialData(e){Promise.all([fetch(this._baseUrl+"/users/me",this._options),fetch(this._baseUrl+"/cards",this._options)]).then(e=>Promise.all(e.map(e=>e.ok?e.json():Promise.reject("Error: "+e.status)))).then(t=>{e(t)}).catch(e=>{console.log(e)})}updateUserInfo(e){return this._options.method="PATCH",this._options.body=JSON.stringify(e),this._getDataPromise("users/me")}updateUserAvatar(e){return this._options.method="PATCH",this._options.body=JSON.stringify({avatar:e}),this._getDataPromise("users/me/avatar")}addCard(e,t){return this._options.method="POST",this._options.body=JSON.stringify({name:e,link:t}),this._getDataPromise("cards")}removeCard(e){return this._options.method="DELETE",this._getDataPromise("cards/"+e)}addCardLike(e){return this._options.method="PUT",this._getDataPromise("cards/likes/"+e)}removeCardLike(e){return this._options.method="DELETE",this._getDataPromise("cards/likes/"+e)}}("https://around.nomoreparties.co/v1/group-3",{headers:{authorization:"aae17431-b773-4b38-a586-5c35cb6461b9","Content-Type":"application/json"}}),d=new class{constructor(e,t,s){this._nameELement=document.querySelector(e),this._titleElement=document.querySelector(t),this._avatarElement=document.querySelector(s),this._name=this._nameELement.textContent,this._title=this._titleElement.textContent,this._avatar=this._avatarElement.src}getUserInfo(){return{name:this._name,about:this._title}}setUserInfo({name:e,about:t,avatar:s,_id:r}){this._name=e,this._title=t,this._avatar=s,this._nameELement.textContent=e,this._titleElement.textContent=t,this._avatarElement.src=s,this._id=r}getUserId(){return this._id}getAvatar(){return this._avatar}setAvatarElement(e){this._avatarElement.style.backgroundImage=`url(${e})`}}(".profile__name",".profile__title",".profile__avatar"),m=new class extends c{constructor(e){super(e),super.setOverlayListener(e=>{e.addEventListener("click",()=>super.close())})}open(e,t){super.populatePopup(s=>{const r=s,i=r.querySelector(".form__pic");i.src=e,i.alt="Picture of "+t,r.querySelector(".form__pic-name").textContent=t}),super.open()}}(".place-popup"),p=new _(".confirm-popup",{}),v={handleCardClick:(e,t)=>m.open(e,t),confirmDelete:e=>{p.setCallbacks({promise:()=>h.removeCard(e.getId()),callback:()=>e.remove()}),p.enableSaveButton(e=>{e.classList.remove("form__save-button_disabled"),e.disabled=!1}),p.open()},handleAddLike:e=>h.addCardLike(e),handleRemoveLike:e=>h.removeCardLike(e)},f=e=>d.setUserInfo(e);let k=null;h.getInitialData(([e,t])=>{f(e),k=new r({items:t,renderer:t=>{const s=new i(t,".place-template",v,e._id);k.appendItem(s.getCardElement())}},".places"),k.renderItems()});const b=new _(".new-place-form",{promise:({name:e,link:t})=>h.addCard(e,t),callback:e=>{const t=new i(e,".place-template",v);k.prependItem(t.getCardElement())}});l.addEventListener("click",()=>b.open());const E=new _(".edit-profile-form",{promise:e=>h.updateUserInfo(e),callback:f});o.addEventListener("click",()=>{const e=d.getUserInfo();E.populatePopup(t=>{const s=t;s.querySelector(".form__input_type_name").value=e.name,s.querySelector(".form__input_type_title").value=e.about}),E.open()});const g=new _(".edit-profile-picture",{promise:e=>h.updateUserAvatar(e.link),callback:f});a.addEventListener("click",()=>{g.open()});[...document.querySelectorAll(".form")].filter(e=>!e.classList.contains("form_display_pic")&&!e.classList.contains("form_confirm_delete")).forEach(e=>{new u({submitButtonSelector:".form__save-button",inputSelector:".form__input",inputErrorClass:"form__input_type_error-indicator",errorClass:"form__input-error-msg",inactiveButtonClass:"form__save-button_disabled"},e).enableValidation()})}]);